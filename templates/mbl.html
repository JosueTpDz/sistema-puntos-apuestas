<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBL CASA APUESTAS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 2rem;
            width: 100%;
            max-width: 1200px;
            margin: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            color: #4a5568;
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            color: #718096;
            font-size: 1.1rem;
        }

        .login-section {
            background: #f7fafc;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            border: 2px solid #e2e8f0;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #4a5568;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }

        .dashboard {
            display: none;
        }

        .user-info {
            background: #edf2f7;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: #718096;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .clients-section {
            background: #f7fafc;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }

        .client-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .clients-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .client-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .client-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .client-name {
            font-weight: bold;
            color: #4a5568;
            font-size: 1.1rem;
        }

        .client-info {
            color: #718096;
            font-size: 0.9rem;
        }

        .canjes-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        .canje-item {
            background: #f0fff4;
            padding: 0.5rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            border-left: 3px solid #48bb78;
        }

        .admin-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .hidden {
            display: none !important;
        }

        .error {
            color: #e53e3e;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .success {
            color: #38a169;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .client-form {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sección de Login -->
        <div id="loginSection">
            <div class="header">
                <h1>🎰 MBL CASA APUESTAS</h1>
                <p>Sistema de Gestión de Clientes y Canjes</p>
            </div>

            <div class="login-section">
                <h3>Iniciar Sesión</h3>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">Usuario:</label>
                        <select id="username" required>
                            <option value="">Seleccione un usuario</option>
                            <option value="admin">Administrador</option>
                            <option value="user1">Usuario 1</option>
                            <option value="user2">Usuario 2</option>
                            <option value="user3">Usuario 3</option>
                            <option value="user4">Usuario 4</option>
                            <option value="user5">Usuario 5</option>
                            <option value="user6">Usuario 6</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="password">Contraseña:</label>
                        <input type="password" id="password" required>
                    </div>
                    <button type="submit" class="btn">Ingresar</button>
                    <div id="loginError" class="error hidden"></div>
                </form>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="dashboard">
            <div class="user-info">
                <div>
                    <h2 id="welcomeMessage"></h2>
                    <p id="userRole"></p>
                </div>
                <button onclick="logout()" class="btn btn-danger">Cerrar Sesión</button>
            </div>

            <!-- Tabs de navegación -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('clients')">Clientes</button>
                <button class="tab" onclick="showTab('canjes')">Canjes</button>
                <button class="tab hidden" id="adminTab" onclick="showTab('admin')">Vista Admin</button>
            </div>

            <!-- Contenido de Clientes -->
            <div id="clientsTab" class="tab-content active">
                <div class="clients-section">
                    <h3>Gestión de Clientes</h3>
                    <form id="clientForm" class="client-form">
                        <div class="form-group">
                            <label for="clientName">Nombre Completo:</label>
                            <input type="text" id="clientName" required>
                        </div>
                        <div class="form-group">
                            <label for="clientDNI">DNI:</label>
                            <input type="text" id="clientDNI" required pattern="[0-9]{8}">
                        </div>
                        <div class="form-group">
                            <label for="clientPhone">Número de Teléfono:</label>
                            <input type="tel" id="clientPhone" required>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-secondary">Agregar Cliente</button>
                        </div>
                    </form>
                    <div id="clientMessage" class="hidden"></div>
                </div>

                <div id="clientsList" class="clients-list"></div>
            </div>

            <!-- Contenido de Canjes -->
            <div id="canjesTab" class="tab-content">
                <div class="clients-section">
                    <h3>Registrar Canje</h3>
                    <form id="canjeForm" class="client-form">
                        <div class="form-group">
                            <label for="canjeClient">Cliente:</label>
                            <select id="canjeClient" required>
                                <option value="">Seleccione un cliente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="canjeAmount">Monto del Canje:</label>
                            <input type="number" id="canjeAmount" required min="0" step="0.01">
                        </div>
                        <div class="form-group">
                            <label for="canjeDescription">Descripción:</label>
                            <input type="text" id="canjeDescription" required>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-secondary">Registrar Canje</button>
                        </div>
                    </form>
                    <div id="canjeMessage" class="hidden"></div>
                </div>

                <div id="canjesList" class="clients-list"></div>
            </div>

            <!-- Vista Admin -->
            <div id="adminTab" class="tab-content">
                <div class="admin-overview">
                    <div class="stat-card">
                        <div class="stat-number" id="totalClients">0</div>
                        <div>Total Clientes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalCanjes">0</div>
                        <div>Total Canjes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalAmount">S/ 0.00</div>
                        <div>Monto Total</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activeUsers">6</div>
                        <div>Usuarios Activos</div>
                    </div>
                </div>

                <div class="clients-section">
                    <h3>Todos los Clientes del Sistema</h3>
                    <div id="adminClientsList" class="clients-list"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sistema de usuarios y contraseñas
        const users = {
            admin: { password: 'admin123', role: 'Administrador', isAdmin: true },
            user1: { password: 'user123', role: 'Operador 1', isAdmin: false },
            user2: { password: 'user123', role: 'Operador 2', isAdmin: false },
            user3: { password: 'user123', role: 'Operador 3', isAdmin: false },
            user4: { password: 'user123', role: 'Operador 4', isAdmin: false },
            user5: { password: 'user123', role: 'Operador 5', isAdmin: false },
            user6: { password: 'user123', role: 'Operador 6', isAdmin: false }
        };

        let currentUser = null;
        let clientsData = {};
        let canjesData = {};

        // Inicializar datos para cada usuario
        Object.keys(users).forEach(user => {
            clientsData[user] = [];
            canjesData[user] = [];
        });

        // Login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');

            if (users[username] && users[username].password === password) {
                currentUser = username;
                showDashboard();
                errorDiv.classList.add('hidden');
            } else {
                errorDiv.textContent = 'Usuario o contraseña incorrectos';
                errorDiv.classList.remove('hidden');
            }
        });

        function showDashboard() {
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            const user = users[currentUser];
            document.getElementById('welcomeMessage').textContent = `Bienvenido, ${user.role}`;
            document.getElementById('userRole').textContent = `Usuario: ${currentUser}`;

            // Mostrar tab admin solo para administradores
            if (user.isAdmin) {
                document.getElementById('adminTab').classList.remove('hidden');
            }

            loadClients();
            loadCanjes();
            updateCanjeClientSelect();
            if (user.isAdmin) {
                updateAdminStats();
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('loginForm').reset();
            showTab('clients');
        }

        function showTab(tabName) {
            // Ocultar todos los tabs
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.remove('active'));

            // Desactivar todos los botones de tab
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(button => button.classList.remove('active'));

            // Mostrar el tab seleccionado
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Activar el botón correspondiente
            const activeButton = Array.from(tabButtons).find(button => 
                button.textContent.toLowerCase().includes(tabName) || 
                button.getAttribute('onclick').includes(tabName)
            );
            if (activeButton) {
                activeButton.classList.add('active');
            }

            // Actualizar datos según el tab
            if (tabName === 'admin' && users[currentUser].isAdmin) {
                loadAllClients();
                updateAdminStats();
            }
        }

        // Gestión de clientes
        document.getElementById('clientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('clientName').value;
            const dni = document.getElementById('clientDNI').value;
            const phone = document.getElementById('clientPhone').value;
            const messageDiv = document.getElementById('clientMessage');

            // Validar DNI único en el sistema
            let dniExists = false;
            Object.keys(clientsData).forEach(user => {
                if (clientsData[user].some(client => client.dni === dni)) {
                    dniExists = true;
                }
            });

            if (dniExists) {
                messageDiv.textContent = 'Este DNI ya está registrado en el sistema';
                messageDiv.className = 'error';
                messageDiv.classList.remove('hidden');
                return;
            }

            const client = {
                id: Date.now(),
                name: name,
                dni: dni,
                phone: phone,
                user: currentUser,
                createdAt: new Date().toLocaleString()
            };

            clientsData[currentUser].push(client);
            
            messageDiv.textContent = 'Cliente agregado exitosamente';
            messageDiv.className = 'success';
            messageDiv.classList.remove('hidden');
            
            this.reset();
            loadClients();
            updateCanjeClientSelect();

            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 3000);
        });

        function loadClients() {
            const clientsList = document.getElementById('clientsList');
            const clients = clientsData[currentUser] || [];

            if (clients.length === 0) {
                clientsList.innerHTML = '<p style="text-align: center; color: #718096;">No hay clientes registrados</p>';
                return;
            }

            clientsList.innerHTML = clients.map(client => `
                <div class="client-card">
                    <div class="client-header">
                        <div class="client-name">${client.name}</div>
                        <button onclick="deleteClient(${client.id})" class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;">
                            Eliminar
                        </button>
                    </div>
                    <div class="client-info">
                        <strong>DNI:</strong> ${client.dni}<br>
                        <strong>Teléfono:</strong> ${client.phone}<br>
                        <strong>Registrado:</strong> ${client.createdAt}
                    </div>
                    <div class="canjes-section">
                        <strong>Canjes (${getClientCanjes(client.id).length}):</strong>
                        ${getClientCanjesHTML(client.id)}
                    </div>
                </div>
            `).join('');
        }

        function deleteClient(clientId) {
            if (confirm('¿Está seguro de eliminar este cliente? Se eliminarán también todos sus canjes.')) {
                clientsData[currentUser] = clientsData[currentUser].filter(client => client.id !== clientId);
                canjesData[currentUser] = canjesData[currentUser].filter(canje => canje.clientId !== clientId);
                loadClients();
                loadCanjes();
                updateCanjeClientSelect();
            }
        }

        // Gestión de canjes
        document.getElementById('canjeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const clientId = parseInt(document.getElementById('canjeClient').value);
            const amount = parseFloat(document.getElementById('canjeAmount').value);
            const description = document.getElementById('canjeDescription').value;
            const messageDiv = document.getElementById('canjeMessage');

            const canje = {
                id: Date.now(),
                clientId: clientId,
                amount: amount,
                description: description,
                user: currentUser,
                createdAt: new Date().toLocaleString()
            };

            canjesData[currentUser].push(canje);
            
            messageDiv.textContent = 'Canje registrado exitosamente';
            messageDiv.className = 'success';
            messageDiv.classList.remove('hidden');
            
            this.reset();
            loadCanjes();
            loadClients(); // Actualizar para mostrar canjes en cards de clientes

            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 3000);
        });

        function updateCanjeClientSelect() {
            const select = document.getElementById('canjeClient');
            const clients = clientsData[currentUser] || [];

            select.innerHTML = '<option value="">Seleccione un cliente</option>';
            
            clients.forEach(client => {
                select.innerHTML += `<option value="${client.id}">${client.name} - ${client.dni}</option>`;
            });
        }

        function loadCanjes() {
            const canjesList = document.getElementById('canjesList');
            const canjes = canjesData[currentUser] || [];

            if (canjes.length === 0) {
                canjesList.innerHTML = '<p style="text-align: center; color: #718096;">No hay canjes registrados</p>';
                return;
            }

            canjesList.innerHTML = canjes.map(canje => {
                const client = getClientById(canje.clientId);
                return `
                    <div class="client-card">
                        <div class="client-header">
                            <div class="client-name">S/ ${canje.amount.toFixed(2)}</div>
                            <button onclick="deleteCanje(${canje.id})" class="btn btn-danger" style="padding: 5px 10px; font-size: 0.8rem;">
                                Eliminar
                            </button>
                        </div>
                        <div class="client-info">
                            <strong>Cliente:</strong> ${client ? client.name : 'Cliente no encontrado'}<br>
                            <strong>DNI:</strong> ${client ? client.dni : 'N/A'}<br>
                            <strong>Descripción:</strong> ${canje.description}<br>
                            <strong>Fecha:</strong> ${canje.createdAt}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function deleteCanje(canjeId) {
            if (confirm('¿Está seguro de eliminar este canje?')) {
                canjesData[currentUser] = canjesData[currentUser].filter(canje => canje.id !== canjeId);
                loadCanjes();
                loadClients(); // Actualizar para reflejar cambios en cards de clientes
            }
        }

        function getClientById(clientId) {
            return clientsData[currentUser].find(client => client.id === clientId);
        }

        function getClientCanjes(clientId) {
            return canjesData[currentUser].filter(canje => canje.clientId === clientId);
        }

        function getClientCanjesHTML(clientId) {
            const canjes = getClientCanjes(clientId);
            if (canjes.length === 0) {
                return '<div style="color: #718096; font-style: italic;">No hay canjes registrados</div>';
            }
            
            return canjes.map(canje => `
                <div class="canje-item">
                    S/ ${canje.amount.toFixed(2)} - ${canje.description} (${canje.createdAt})
                </div>
            `).join('');
        }

        // Funciones de administrador
        function loadAllClients() {
            if (!users[currentUser].isAdmin) return;

            const adminClientsList = document.getElementById('adminClientsList');
            let allClients = [];

            Object.keys(clientsData).forEach(user => {
                clientsData[user].forEach(client => {
                    allClients.push({...client, userOwner: user});
                });
            });

            if (allClients.length === 0) {
                adminClientsList.innerHTML = '<p style="text-align: center; color: #718096;">No hay clientes en el sistema</p>';
                return;
            }

            adminClientsList.innerHTML = allClients.map(client => `
                <div class="client-card">
                    <div class="client-header">
                        <div class="client-name">${client.name}</div>
                        <div style="color: #667eea; font-weight: bold;">${users[client.userOwner].role}</div>
                    </div>
                    <div class="client-info">
                        <strong>DNI:</strong> ${client.dni}<br>
                        <strong>Teléfono:</strong> ${client.phone}<br>
                        <strong>Usuario:</strong> ${client.userOwner}<br>
                        <strong>Registrado:</strong> ${client.createdAt}
                    </div>
                    <div class="canjes-section">
                        <strong>Canjes (${getAllClientCanjes(client.id, client.userOwner).length}):</strong>
                        ${getAllClientCanjesHTML(client.id, client.userOwner)}
                    </div>
                </div>
            `).join('');
        }

        function getAllClientCanjes(clientId, userOwner) {
            return canjesData[userOwner].filter(canje => canje.clientId === clientId);
        }

        function getAllClientCanjesHTML(clientId, userOwner) {
            const canjes = getAllClientCanjes(clientId, userOwner);
            if (canjes.length === 0) {
                return '<div style="color: #718096; font-style: italic;">No hay canjes registrados</div>';
            }
            
            return canjes.map(canje => `
                <div class="canje-item">
                    S/ ${canje.amount.toFixed(2)} - ${canje.description} (${canje.createdAt})
                </div>
            `).join('');
        }

        function updateAdminStats() {
            if (!users[currentUser].isAdmin) return;

            let totalClients = 0;
            let totalCanjes = 0;
            let totalAmount = 0;

            Object.keys(clientsData).forEach(user => {
                totalClients += clientsData[user].length;
                totalCanjes += canjesData[user].length;
                canjesData[user].forEach(canje => {
                    totalAmount += canje.amount;
                });
            });

            document.getElementById('totalClients').textContent = totalClients;
            document.getElementById('totalCanjes').textContent = totalCanjes;
            document.getElementById('totalAmount').textContent = `S/ ${totalAmount.toFixed(2)}`;
        }
    </script>
</body>
</html>